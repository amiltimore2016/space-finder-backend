"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const InputValidator_1 = require("../Shared/InputValidator");
const Utils_1 = require("../Shared/Utils");
const TABLE_NAME = process.env.TABLE_NAME;
const dbClient = new aws_sdk_1.DynamoDB.DocumentClient();
async function handler(event, context) {
    const result = {
        statusCode: 200,
        body: 'Hello from DynamoDB'
    };
    try {
        const item = typeof event.body == 'object' ? event.body : JSON.parse(event.body);
        item.spaceId = (0, Utils_1.generateRandomId)();
        (0, InputValidator_1.validateAsSpaceEntry)(item);
        await dbClient.put({
            TableName: TABLE_NAME,
            Item: item
        }).promise();
        result.body = JSON.stringify(`Created item with id: ${item.spaceId}`);
    }
    catch (error) {
        if (error instanceof InputValidator_1.MissingFieldError) {
            result.statusCode = 403;
        }
        else {
            result.statusCode = 500;
        }
        if (error instanceof Error) {
            result.body = error.message;
        }
    }
    return result;
}
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ3JlYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFrQztBQUVsQyw2REFBbUY7QUFDbkYsMkNBQW1EO0FBRW5ELE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDO0FBQzFDLE1BQU0sUUFBUSxHQUFHLElBQUksa0JBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUUvQyxLQUFLLFVBQVUsT0FBTyxDQUFDLEtBQTJCLEVBQUUsT0FBZ0I7SUFDaEUsTUFBTSxNQUFNLEdBQTBCO1FBQ2xDLFVBQVUsRUFBRSxHQUFHO1FBQ2YsSUFBSSxFQUFFLHFCQUFxQjtLQUM5QixDQUFBO0lBQ0QsSUFBSTtRQUNBLE1BQU0sSUFBSSxHQUFHLE9BQU8sS0FBSyxDQUFDLElBQUksSUFBSSxRQUFRLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9FLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBQSx3QkFBZ0IsR0FBRSxDQUFDO1FBQ2xDLElBQUEscUNBQW9CLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsTUFBTSxRQUFRLENBQUMsR0FBRyxDQUFDO1lBQ2YsU0FBUyxFQUFFLFVBQVc7WUFDdEIsSUFBSSxFQUFFLElBQUk7U0FDYixDQUNBLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDWCxNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMseUJBQXlCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO0tBQ3hFO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDWixJQUFJLEtBQUssWUFBWSxrQ0FBaUIsRUFBRTtZQUNwQyxNQUFNLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQTtTQUMxQjthQUFNO1lBQ0wsTUFBTSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7U0FDekI7UUFDRCxJQUFJLEtBQUssWUFBWSxLQUFLLEVBQUU7WUFDeEIsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO1NBQzlCO0tBQ0o7SUFDRCxPQUFPLE1BQU0sQ0FBQTtBQUNqQixDQUFDO0FBRVEsMEJBQU8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEeW5hbW9EQiB9IGZyb20gJ2F3cy1zZGsnXG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCwgQVBJR2F0ZXdheVByb3h5UmVzdWx0LCBDb250ZXh0IH0gZnJvbSAnYXdzLWxhbWJkYSdcbmltcG9ydCB7IE1pc3NpbmdGaWVsZEVycm9yLCB2YWxpZGF0ZUFzU3BhY2VFbnRyeSB9IGZyb20gJy4uL1NoYXJlZC9JbnB1dFZhbGlkYXRvcic7XG5pbXBvcnQgeyBnZW5lcmF0ZVJhbmRvbUlkIH0gZnJvbSAnLi4vU2hhcmVkL1V0aWxzJztcblxuY29uc3QgVEFCTEVfTkFNRSA9IHByb2Nlc3MuZW52LlRBQkxFX05BTUU7XG5jb25zdCBkYkNsaWVudCA9IG5ldyBEeW5hbW9EQi5Eb2N1bWVudENsaWVudCgpO1xuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVyKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCwgY29udGV4dDogQ29udGV4dCk6IFByb21pc2U8QVBJR2F0ZXdheVByb3h5UmVzdWx0PntcbiAgICBjb25zdCByZXN1bHQ6IEFQSUdhdGV3YXlQcm94eVJlc3VsdCA9IHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxuICAgICAgICBib2R5OiAnSGVsbG8gZnJvbSBEeW5hbW9EQidcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHR5cGVvZiBldmVudC5ib2R5ID09ICdvYmplY3QnPyBldmVudC5ib2R5OiBKU09OLnBhcnNlKGV2ZW50LmJvZHkpO1xuICAgICAgICBpdGVtLnNwYWNlSWQgPSBnZW5lcmF0ZVJhbmRvbUlkKCk7XG4gICAgICAgIHZhbGlkYXRlQXNTcGFjZUVudHJ5KGl0ZW0pO1xuICAgICAgICBhd2FpdCBkYkNsaWVudC5wdXQoe1xuICAgICAgICAgICAgVGFibGVOYW1lOiBUQUJMRV9OQU1FISxcbiAgICAgICAgICAgIEl0ZW06IGl0ZW1cbiAgICAgICAgfVxuICAgICAgICApLnByb21pc2UoKVxuICAgICAgICByZXN1bHQuYm9keSA9IEpTT04uc3RyaW5naWZ5KGBDcmVhdGVkIGl0ZW0gd2l0aCBpZDogJHtpdGVtLnNwYWNlSWR9YClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBNaXNzaW5nRmllbGRFcnJvcikge1xuICAgICAgICAgICAgcmVzdWx0LnN0YXR1c0NvZGUgPSA0MDNcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQuc3RhdHVzQ29kZSA9IDUwMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgcmVzdWx0LmJvZHkgPSBlcnJvci5tZXNzYWdlXG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdFxufVxuXG5leHBvcnQgeyBoYW5kbGVyIH0iXX0=