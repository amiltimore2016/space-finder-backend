"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const InputValidator_1 = require("../Shared/InputValidator");
const Utils_1 = require("../Shared/Utils");
const TABLE_NAME = process.env.TABLE_NAME;
const dbClient = new aws_sdk_1.DynamoDB.DocumentClient();
async function handler(event, context) {
    const result = {
        statusCode: 200,
        body: 'Hello from DynamoDB'
    };
    try {
        const item = (0, Utils_1.getEventBody)(event);
        item.spaceId = (0, Utils_1.generateRandomId)();
        (0, InputValidator_1.validateAsSpaceEntry)(item);
        await dbClient.put({
            TableName: TABLE_NAME,
            Item: item
        }).promise();
        result.body = JSON.stringify(`Created item with id: ${item.spaceId}`);
    }
    catch (error) {
        if (error instanceof InputValidator_1.MissingFieldError) {
            result.statusCode = 403;
        }
        else {
            result.statusCode = 500;
        }
        if (error instanceof Error) {
            result.body = error.message;
        }
    }
    return result;
}
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ3JlYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFrQztBQUVsQyw2REFBbUY7QUFDbkYsMkNBQWlFO0FBRWpFLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDO0FBQzFDLE1BQU0sUUFBUSxHQUFHLElBQUksa0JBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUUvQyxLQUFLLFVBQVUsT0FBTyxDQUFDLEtBQTJCLEVBQUUsT0FBZ0I7SUFDaEUsTUFBTSxNQUFNLEdBQTBCO1FBQ2xDLFVBQVUsRUFBRSxHQUFHO1FBQ2YsSUFBSSxFQUFFLHFCQUFxQjtLQUM5QixDQUFBO0lBQ0QsSUFBSTtRQUNBLE1BQU0sSUFBSSxHQUFHLElBQUEsb0JBQVksRUFBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUEsd0JBQWdCLEdBQUUsQ0FBQztRQUNsQyxJQUFBLHFDQUFvQixFQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNCLE1BQU0sUUFBUSxDQUFDLEdBQUcsQ0FBQztZQUNmLFNBQVMsRUFBRSxVQUFXO1lBQ3RCLElBQUksRUFBRSxJQUFJO1NBQ2IsQ0FDQSxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBQ1gsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHlCQUF5QixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtLQUN4RTtJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ1osSUFBSSxLQUFLLFlBQVksa0NBQWlCLEVBQUU7WUFDcEMsTUFBTSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUE7U0FDMUI7YUFBTTtZQUNMLE1BQU0sQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDO1NBQ3pCO1FBQ0QsSUFBSSxLQUFLLFlBQVksS0FBSyxFQUFFO1lBQ3hCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtTQUM5QjtLQUNKO0lBQ0QsT0FBTyxNQUFNLENBQUE7QUFDakIsQ0FBQztBQUVRLDBCQUFPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHluYW1vREIgfSBmcm9tICdhd3Mtc2RrJ1xuaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnQsIEFQSUdhdGV3YXlQcm94eVJlc3VsdCwgQ29udGV4dCB9IGZyb20gJ2F3cy1sYW1iZGEnXG5pbXBvcnQgeyBNaXNzaW5nRmllbGRFcnJvciwgdmFsaWRhdGVBc1NwYWNlRW50cnkgfSBmcm9tICcuLi9TaGFyZWQvSW5wdXRWYWxpZGF0b3InO1xuaW1wb3J0IHsgZ2VuZXJhdGVSYW5kb21JZCwgZ2V0RXZlbnRCb2R5IH0gZnJvbSAnLi4vU2hhcmVkL1V0aWxzJztcblxuY29uc3QgVEFCTEVfTkFNRSA9IHByb2Nlc3MuZW52LlRBQkxFX05BTUU7XG5jb25zdCBkYkNsaWVudCA9IG5ldyBEeW5hbW9EQi5Eb2N1bWVudENsaWVudCgpO1xuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVyKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCwgY29udGV4dDogQ29udGV4dCk6IFByb21pc2U8QVBJR2F0ZXdheVByb3h5UmVzdWx0PntcbiAgICBjb25zdCByZXN1bHQ6IEFQSUdhdGV3YXlQcm94eVJlc3VsdCA9IHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxuICAgICAgICBib2R5OiAnSGVsbG8gZnJvbSBEeW5hbW9EQidcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGdldEV2ZW50Qm9keShldmVudCk7XG4gICAgICAgIGl0ZW0uc3BhY2VJZCA9IGdlbmVyYXRlUmFuZG9tSWQoKTtcbiAgICAgICAgdmFsaWRhdGVBc1NwYWNlRW50cnkoaXRlbSk7XG4gICAgICAgIGF3YWl0IGRiQ2xpZW50LnB1dCh7XG4gICAgICAgICAgICBUYWJsZU5hbWU6IFRBQkxFX05BTUUhLFxuICAgICAgICAgICAgSXRlbTogaXRlbVxuICAgICAgICB9XG4gICAgICAgICkucHJvbWlzZSgpXG4gICAgICAgIHJlc3VsdC5ib2R5ID0gSlNPTi5zdHJpbmdpZnkoYENyZWF0ZWQgaXRlbSB3aXRoIGlkOiAke2l0ZW0uc3BhY2VJZH1gKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE1pc3NpbmdGaWVsZEVycm9yKSB7XG4gICAgICAgICAgICByZXN1bHQuc3RhdHVzQ29kZSA9IDQwM1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdC5zdGF0dXNDb2RlID0gNTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICByZXN1bHQuYm9keSA9IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG59XG5cbmV4cG9ydCB7IGhhbmRsZXIgfSJdfQ==